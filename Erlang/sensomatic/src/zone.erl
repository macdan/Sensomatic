-module( zone ).

-export( [ 
	start_link/0,
	start_link/1
] ).

-behaviour( gen_server ).
-export( [ 
	init/1, 
	handle_call/3, 
	handle_cast/2, 
	handle_info/2, 
	code_change/3, 
	terminate/2 
] ).

-record( state, { 
	event,
	ports = []
} ).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Module API
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%==============================================================================
%% start_link/0
%%==============================================================================
start_link() ->
	start_link( [] ).

%%==============================================================================
%% start_link/1
%%==============================================================================
start_link( Options ) ->
    gen_server:start_link( ?MODULE, [ Options ], [] ).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% gen_server callbacks
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%==============================================================================
%% init
%%==============================================================================
init( [ Options ] ) ->
	util:shout( "Starting ~p gen_server...", [ ?MODULE ] ),
	
	{ ok, EventPid } = gen_event:start_link(),
	
	Ports = case proplists:lookup( ports, Options ) of
		{ ports, P } -> P;
		none         -> []
	end,
	
	{ ok, #state{ 
		ports = Ports, 
		event = EventPid 
	} }.

%%==============================================================================
%% handle_call
%%==============================================================================
%% Catch All
%%------------------------------------------------------------------------------
handle_call( _E, _From, State ) ->
	{ noreply, State }.

%%==============================================================================
%% handle_cast
%%==============================================================================
%% Catch All
%%------------------------------------------------------------------------------
handle_cast( _, State ) ->
	{ noreply, State }.

%%==============================================================================
%% handle_info
%%==============================================================================
%% Catch all
%%------------------------------------------------------------------------------
handle_info( E, S ) ->
    util:shout( "unexpected: ~p~n", [ E ] ),
    { noreply, S }.

%%==============================================================================
%% code_change/3
%%==============================================================================
code_change( _OldVsn, State, _Extra ) ->
    { ok, State }.

%%==============================================================================
%% terminate/2
%%==============================================================================
terminate( Reason, _State ) ->
	util:shout( "terminate reason: ~p~n", [ Reason ] ).

